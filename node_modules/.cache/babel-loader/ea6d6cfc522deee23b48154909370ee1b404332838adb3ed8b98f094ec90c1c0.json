{"ast":null,"code":"import \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport { asyncRouterMap, constantRouterMap } from '@/config/router.config';\nimport cloneDeep from 'lodash.clonedeep';\n\n/**\n * 过滤账户是否拥有某一个权限，并将菜单从加载列表移除\n *\n * @param permission\n * @param route\n * @returns {boolean}\n */\nfunction hasPermission(permission, route) {\n  if (route.meta && route.meta.permission) {\n    console.log('hasPermission', permission);\n    if (permission === undefined) {\n      return false;\n    }\n    var flag = false;\n    for (var i = 0, len = permission.length; i < len; i++) {\n      flag = route.meta.permission.includes(permission[i]);\n      if (flag) {\n        return true;\n      }\n    }\n    return false;\n  }\n  return true;\n}\n\n/**\n * 单账户多角色时，使用该方法可过滤角色不存在的菜单\n *\n * @param roles\n * @param route\n * @returns {*}\n */\n// eslint-disable-next-line\nfunction hasRole(roles, route) {\n  if (route.meta && route.meta.roles) {\n    return route.meta.roles.includes(roles.id);\n  } else {\n    return true;\n  }\n}\nfunction filterAsyncRouter(routerMap, role) {\n  var accessedRouters = routerMap.filter(function (route) {\n    if (hasPermission(role.permissionList, route)) {\n      if (route.children && route.children.length) {\n        route.children = filterAsyncRouter(route.children, role);\n      }\n      return true;\n    }\n    return false;\n  });\n  return accessedRouters;\n}\nvar permission = {\n  state: {\n    routers: constantRouterMap,\n    addRouters: []\n  },\n  mutations: {\n    SET_ROUTERS: function SET_ROUTERS(state, routers) {\n      state.addRouters = routers;\n      state.routers = constantRouterMap.concat(routers);\n    }\n  },\n  actions: {\n    GenerateRoutes: function GenerateRoutes(_ref, data) {\n      var commit = _ref.commit;\n      return new Promise(function (resolve) {\n        var role = data.role;\n        var routerMap = cloneDeep(asyncRouterMap);\n        var accessedRouters = filterAsyncRouter(routerMap, role);\n        commit('SET_ROUTERS', accessedRouters);\n        resolve();\n      });\n    }\n  }\n};\nexport default permission;","map":{"version":3,"names":["asyncRouterMap","constantRouterMap","cloneDeep","hasPermission","permission","route","meta","console","log","undefined","flag","i","len","length","includes","hasRole","roles","id","filterAsyncRouter","routerMap","role","accessedRouters","filter","permissionList","children","state","routers","addRouters","mutations","SET_ROUTERS","concat","actions","GenerateRoutes","data","commit","Promise","resolve"],"sources":["/home/cg/public/h1emu-boot-vue/src/store/modules/static-router.js"],"sourcesContent":["import { asyncRouterMap, constantRouterMap } from '@/config/router.config'\nimport cloneDeep from 'lodash.clonedeep'\n\n/**\n * 过滤账户是否拥有某一个权限，并将菜单从加载列表移除\n *\n * @param permission\n * @param route\n * @returns {boolean}\n */\nfunction hasPermission (permission, route) {\n  if (route.meta && route.meta.permission) {\n    console.log('hasPermission', permission)\n    if (permission === undefined) {\n      return false\n    }\n    let flag = false\n    for (let i = 0, len = permission.length; i < len; i++) {\n      flag = route.meta.permission.includes(permission[i])\n      if (flag) {\n        return true\n      }\n    }\n    return false\n  }\n  return true\n}\n\n/**\n * 单账户多角色时，使用该方法可过滤角色不存在的菜单\n *\n * @param roles\n * @param route\n * @returns {*}\n */\n// eslint-disable-next-line\nfunction hasRole(roles, route) {\n  if (route.meta && route.meta.roles) {\n    return route.meta.roles.includes(roles.id)\n  } else {\n    return true\n  }\n}\n\nfunction filterAsyncRouter (routerMap, role) {\n  const accessedRouters = routerMap.filter(route => {\n    if (hasPermission(role.permissionList, route)) {\n      if (route.children && route.children.length) {\n        route.children = filterAsyncRouter(route.children, role)\n      }\n      return true\n    }\n    return false\n  })\n  return accessedRouters\n}\n\nconst permission = {\n  state: {\n    routers: constantRouterMap,\n    addRouters: []\n  },\n  mutations: {\n    SET_ROUTERS: (state, routers) => {\n      state.addRouters = routers\n      state.routers = constantRouterMap.concat(routers)\n    }\n  },\n  actions: {\n    GenerateRoutes ({ commit }, data) {\n      return new Promise(resolve => {\n        const { role } = data\n        const routerMap = cloneDeep(asyncRouterMap)\n        const accessedRouters = filterAsyncRouter(routerMap, role)\n        commit('SET_ROUTERS', accessedRouters)\n        resolve()\n      })\n    }\n  }\n}\n\nexport default permission\n"],"mappings":";;;;;AAAA,SAASA,cAAc,EAAEC,iBAAiB,QAAQ,wBAAwB;AAC1E,OAAOC,SAAS,MAAM,kBAAkB;;AAExC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASC,aAAa,CAAEC,UAAU,EAAEC,KAAK,EAAE;EACzC,IAAIA,KAAK,CAACC,IAAI,IAAID,KAAK,CAACC,IAAI,CAACF,UAAU,EAAE;IACvCG,OAAO,CAACC,GAAG,CAAC,eAAe,EAAEJ,UAAU,CAAC;IACxC,IAAIA,UAAU,KAAKK,SAAS,EAAE;MAC5B,OAAO,KAAK;IACd;IACA,IAAIC,IAAI,GAAG,KAAK;IAChB,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEC,GAAG,GAAGR,UAAU,CAACS,MAAM,EAAEF,CAAC,GAAGC,GAAG,EAAED,CAAC,EAAE,EAAE;MACrDD,IAAI,GAAGL,KAAK,CAACC,IAAI,CAACF,UAAU,CAACU,QAAQ,CAACV,UAAU,CAACO,CAAC,CAAC,CAAC;MACpD,IAAID,IAAI,EAAE;QACR,OAAO,IAAI;MACb;IACF;IACA,OAAO,KAAK;EACd;EACA,OAAO,IAAI;AACb;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASK,OAAO,CAACC,KAAK,EAAEX,KAAK,EAAE;EAC7B,IAAIA,KAAK,CAACC,IAAI,IAAID,KAAK,CAACC,IAAI,CAACU,KAAK,EAAE;IAClC,OAAOX,KAAK,CAACC,IAAI,CAACU,KAAK,CAACF,QAAQ,CAACE,KAAK,CAACC,EAAE,CAAC;EAC5C,CAAC,MAAM;IACL,OAAO,IAAI;EACb;AACF;AAEA,SAASC,iBAAiB,CAAEC,SAAS,EAAEC,IAAI,EAAE;EAC3C,IAAMC,eAAe,GAAGF,SAAS,CAACG,MAAM,CAAC,UAAAjB,KAAK,EAAI;IAChD,IAAIF,aAAa,CAACiB,IAAI,CAACG,cAAc,EAAElB,KAAK,CAAC,EAAE;MAC7C,IAAIA,KAAK,CAACmB,QAAQ,IAAInB,KAAK,CAACmB,QAAQ,CAACX,MAAM,EAAE;QAC3CR,KAAK,CAACmB,QAAQ,GAAGN,iBAAiB,CAACb,KAAK,CAACmB,QAAQ,EAAEJ,IAAI,CAAC;MAC1D;MACA,OAAO,IAAI;IACb;IACA,OAAO,KAAK;EACd,CAAC,CAAC;EACF,OAAOC,eAAe;AACxB;AAEA,IAAMjB,UAAU,GAAG;EACjBqB,KAAK,EAAE;IACLC,OAAO,EAAEzB,iBAAiB;IAC1B0B,UAAU,EAAE;EACd,CAAC;EACDC,SAAS,EAAE;IACTC,WAAW,EAAE,qBAACJ,KAAK,EAAEC,OAAO,EAAK;MAC/BD,KAAK,CAACE,UAAU,GAAGD,OAAO;MAC1BD,KAAK,CAACC,OAAO,GAAGzB,iBAAiB,CAAC6B,MAAM,CAACJ,OAAO,CAAC;IACnD;EACF,CAAC;EACDK,OAAO,EAAE;IACPC,cAAc,gCAAcC,IAAI,EAAE;MAAA,IAAhBC,MAAM,QAANA,MAAM;MACtB,OAAO,IAAIC,OAAO,CAAC,UAAAC,OAAO,EAAI;QAC5B,IAAQhB,IAAI,GAAKa,IAAI,CAAbb,IAAI;QACZ,IAAMD,SAAS,GAAGjB,SAAS,CAACF,cAAc,CAAC;QAC3C,IAAMqB,eAAe,GAAGH,iBAAiB,CAACC,SAAS,EAAEC,IAAI,CAAC;QAC1Dc,MAAM,CAAC,aAAa,EAAEb,eAAe,CAAC;QACtCe,OAAO,EAAE;MACX,CAAC,CAAC;IACJ;EACF;AACF,CAAC;AAED,eAAehC,UAAU"},"metadata":{},"sourceType":"module","externalDependencies":[]}