{"ast":null,"code":"import _objectSpread from \"/home/cg/public/h1emu-boot-vue/node_modules/_@babel_runtime@7.20.1@@babel/runtime/helpers/esm/objectSpread2.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport storage from 'store';\nimport expirePlugin from 'store/plugins/expire';\nimport { login, getInfo, logout } from '@/api/login';\nimport { ACCESS_TOKEN } from '@/store/mutation-types';\nimport { welcome } from '@/utils/util';\nstorage.addPlugin(expirePlugin);\nvar user = {\n  state: {\n    token: '',\n    name: '',\n    welcome: '',\n    avatar: '',\n    roles: [],\n    info: {}\n  },\n  mutations: {\n    SET_TOKEN: function SET_TOKEN(state, token) {\n      state.token = token;\n    },\n    SET_NAME: function SET_NAME(state, _ref) {\n      var name = _ref.name,\n        welcome = _ref.welcome;\n      state.name = name;\n      state.welcome = welcome;\n    },\n    SET_AVATAR: function SET_AVATAR(state, avatar) {\n      state.avatar = avatar;\n    },\n    SET_ROLES: function SET_ROLES(state, roles) {\n      state.roles = roles;\n    },\n    SET_INFO: function SET_INFO(state, info) {\n      state.info = info;\n    }\n  },\n  actions: {\n    // 登录\n    Login: function Login(_ref2, userInfo) {\n      var commit = _ref2.commit;\n      return new Promise(function (resolve, reject) {\n        login(userInfo).then(function (response) {\n          var result = response.result;\n          storage.set(ACCESS_TOKEN, result.token, new Date().getTime() + 7 * 24 * 60 * 60 * 1000);\n          commit('SET_TOKEN', result.token);\n          resolve();\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 获取用户信息\n    GetInfo: function GetInfo(_ref3) {\n      var commit = _ref3.commit;\n      return new Promise(function (resolve, reject) {\n        // 请求后端获取用户信息 /api/user/info\n        getInfo().then(function (response) {\n          var result = response.result;\n          if (result.role && result.role.permissions.length > 0) {\n            var role = _objectSpread({}, result.role);\n            role.permissions = result.role.permissions.map(function (permission) {\n              var per = _objectSpread(_objectSpread({}, permission), {}, {\n                actionList: (permission.actionEntitySet || {}).map(function (item) {\n                  return item.action;\n                })\n              });\n              return per;\n            });\n            role.permissionList = role.permissions.map(function (permission) {\n              return permission.permissionId;\n            });\n            // 覆盖响应体的 role, 供下游使用\n            result.role = role;\n            commit('SET_ROLES', role);\n            commit('SET_INFO', result);\n            commit('SET_NAME', {\n              name: result.name,\n              welcome: welcome()\n            });\n            commit('SET_AVATAR', result.avatar);\n            // 下游\n            resolve(result);\n          } else {\n            reject(new Error('getInfo: roles must be a non-null array !'));\n          }\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 登出\n    Logout: function Logout(_ref4) {\n      var commit = _ref4.commit,\n        state = _ref4.state;\n      return new Promise(function (resolve) {\n        logout(state.token).then(function () {\n          commit('SET_TOKEN', '');\n          commit('SET_ROLES', []);\n          storage.remove(ACCESS_TOKEN);\n          resolve();\n        }).catch(function (err) {\n          console.log('logout fail:', err);\n          // resolve()\n        }).finally(function () {});\n      });\n    }\n  }\n};\nexport default user;","map":{"version":3,"names":["storage","expirePlugin","login","getInfo","logout","ACCESS_TOKEN","welcome","addPlugin","user","state","token","name","avatar","roles","info","mutations","SET_TOKEN","SET_NAME","SET_AVATAR","SET_ROLES","SET_INFO","actions","Login","userInfo","commit","Promise","resolve","reject","then","response","result","set","Date","getTime","catch","error","GetInfo","role","permissions","length","map","permission","per","actionList","actionEntitySet","item","action","permissionList","permissionId","Error","Logout","remove","err","console","log","finally"],"sources":["/home/cg/public/h1emu-boot-vue/src/store/modules/user.js"],"sourcesContent":["import storage from 'store'\nimport expirePlugin from 'store/plugins/expire'\nimport { login, getInfo, logout } from '@/api/login'\nimport { ACCESS_TOKEN } from '@/store/mutation-types'\nimport { welcome } from '@/utils/util'\n\nstorage.addPlugin(expirePlugin)\nconst user = {\n  state: {\n    token: '',\n    name: '',\n    welcome: '',\n    avatar: '',\n    roles: [],\n    info: {}\n  },\n\n  mutations: {\n    SET_TOKEN: (state, token) => {\n      state.token = token\n    },\n    SET_NAME: (state, { name, welcome }) => {\n      state.name = name\n      state.welcome = welcome\n    },\n    SET_AVATAR: (state, avatar) => {\n      state.avatar = avatar\n    },\n    SET_ROLES: (state, roles) => {\n      state.roles = roles\n    },\n    SET_INFO: (state, info) => {\n      state.info = info\n    }\n  },\n\n  actions: {\n    // 登录\n    Login ({ commit }, userInfo) {\n      return new Promise((resolve, reject) => {\n        login(userInfo).then(response => {\n          const result = response.result\n          storage.set(ACCESS_TOKEN, result.token, new Date().getTime() + 7 * 24 * 60 * 60 * 1000)\n          commit('SET_TOKEN', result.token)\n          resolve()\n        }).catch(error => {\n          reject(error)\n        })\n      })\n    },\n\n    // 获取用户信息\n    GetInfo ({ commit }) {\n      return new Promise((resolve, reject) => {\n        // 请求后端获取用户信息 /api/user/info\n        getInfo().then(response => {\n          const { result } = response\n          if (result.role && result.role.permissions.length > 0) {\n            const role = { ...result.role }\n            role.permissions = result.role.permissions.map(permission => {\n              const per = {\n                ...permission,\n                actionList: (permission.actionEntitySet || {}).map(item => item.action)\n               }\n              return per\n            })\n            role.permissionList = role.permissions.map(permission => { return permission.permissionId })\n            // 覆盖响应体的 role, 供下游使用\n            result.role = role\n\n            commit('SET_ROLES', role)\n            commit('SET_INFO', result)\n            commit('SET_NAME', { name: result.name, welcome: welcome() })\n            commit('SET_AVATAR', result.avatar)\n            // 下游\n            resolve(result)\n          } else {\n            reject(new Error('getInfo: roles must be a non-null array !'))\n          }\n        }).catch(error => {\n          reject(error)\n        })\n      })\n    },\n\n    // 登出\n    Logout ({ commit, state }) {\n      return new Promise((resolve) => {\n        logout(state.token).then(() => {\n          commit('SET_TOKEN', '')\n          commit('SET_ROLES', [])\n          storage.remove(ACCESS_TOKEN)\n          resolve()\n        }).catch((err) => {\n          console.log('logout fail:', err)\n          // resolve()\n        }).finally(() => {\n        })\n      })\n    }\n\n  }\n}\n\nexport default user\n"],"mappings":";;;;AAAA,OAAOA,OAAO,MAAM,OAAO;AAC3B,OAAOC,YAAY,MAAM,sBAAsB;AAC/C,SAASC,KAAK,EAAEC,OAAO,EAAEC,MAAM,QAAQ,aAAa;AACpD,SAASC,YAAY,QAAQ,wBAAwB;AACrD,SAASC,OAAO,QAAQ,cAAc;AAEtCN,OAAO,CAACO,SAAS,CAACN,YAAY,CAAC;AAC/B,IAAMO,IAAI,GAAG;EACXC,KAAK,EAAE;IACLC,KAAK,EAAE,EAAE;IACTC,IAAI,EAAE,EAAE;IACRL,OAAO,EAAE,EAAE;IACXM,MAAM,EAAE,EAAE;IACVC,KAAK,EAAE,EAAE;IACTC,IAAI,EAAE,CAAC;EACT,CAAC;EAEDC,SAAS,EAAE;IACTC,SAAS,EAAE,mBAACP,KAAK,EAAEC,KAAK,EAAK;MAC3BD,KAAK,CAACC,KAAK,GAAGA,KAAK;IACrB,CAAC;IACDO,QAAQ,EAAE,kBAACR,KAAK,QAAwB;MAAA,IAApBE,IAAI,QAAJA,IAAI;QAAEL,OAAO,QAAPA,OAAO;MAC/BG,KAAK,CAACE,IAAI,GAAGA,IAAI;MACjBF,KAAK,CAACH,OAAO,GAAGA,OAAO;IACzB,CAAC;IACDY,UAAU,EAAE,oBAACT,KAAK,EAAEG,MAAM,EAAK;MAC7BH,KAAK,CAACG,MAAM,GAAGA,MAAM;IACvB,CAAC;IACDO,SAAS,EAAE,mBAACV,KAAK,EAAEI,KAAK,EAAK;MAC3BJ,KAAK,CAACI,KAAK,GAAGA,KAAK;IACrB,CAAC;IACDO,QAAQ,EAAE,kBAACX,KAAK,EAAEK,IAAI,EAAK;MACzBL,KAAK,CAACK,IAAI,GAAGA,IAAI;IACnB;EACF,CAAC;EAEDO,OAAO,EAAE;IACP;IACAC,KAAK,wBAAcC,QAAQ,EAAE;MAAA,IAApBC,MAAM,SAANA,MAAM;MACb,OAAO,IAAIC,OAAO,CAAC,UAACC,OAAO,EAAEC,MAAM,EAAK;QACtCzB,KAAK,CAACqB,QAAQ,CAAC,CAACK,IAAI,CAAC,UAAAC,QAAQ,EAAI;UAC/B,IAAMC,MAAM,GAAGD,QAAQ,CAACC,MAAM;UAC9B9B,OAAO,CAAC+B,GAAG,CAAC1B,YAAY,EAAEyB,MAAM,CAACpB,KAAK,EAAE,IAAIsB,IAAI,EAAE,CAACC,OAAO,EAAE,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC;UACvFT,MAAM,CAAC,WAAW,EAAEM,MAAM,CAACpB,KAAK,CAAC;UACjCgB,OAAO,EAAE;QACX,CAAC,CAAC,CAACQ,KAAK,CAAC,UAAAC,KAAK,EAAI;UAChBR,MAAM,CAACQ,KAAK,CAAC;QACf,CAAC,CAAC;MACJ,CAAC,CAAC;IACJ,CAAC;IAED;IACAC,OAAO,0BAAc;MAAA,IAAVZ,MAAM,SAANA,MAAM;MACf,OAAO,IAAIC,OAAO,CAAC,UAACC,OAAO,EAAEC,MAAM,EAAK;QACtC;QACAxB,OAAO,EAAE,CAACyB,IAAI,CAAC,UAAAC,QAAQ,EAAI;UACzB,IAAQC,MAAM,GAAKD,QAAQ,CAAnBC,MAAM;UACd,IAAIA,MAAM,CAACO,IAAI,IAAIP,MAAM,CAACO,IAAI,CAACC,WAAW,CAACC,MAAM,GAAG,CAAC,EAAE;YACrD,IAAMF,IAAI,qBAAQP,MAAM,CAACO,IAAI,CAAE;YAC/BA,IAAI,CAACC,WAAW,GAAGR,MAAM,CAACO,IAAI,CAACC,WAAW,CAACE,GAAG,CAAC,UAAAC,UAAU,EAAI;cAC3D,IAAMC,GAAG,mCACJD,UAAU;gBACbE,UAAU,EAAE,CAACF,UAAU,CAACG,eAAe,IAAI,CAAC,CAAC,EAAEJ,GAAG,CAAC,UAAAK,IAAI;kBAAA,OAAIA,IAAI,CAACC,MAAM;gBAAA;cAAC,EACvE;cACF,OAAOJ,GAAG;YACZ,CAAC,CAAC;YACFL,IAAI,CAACU,cAAc,GAAGV,IAAI,CAACC,WAAW,CAACE,GAAG,CAAC,UAAAC,UAAU,EAAI;cAAE,OAAOA,UAAU,CAACO,YAAY;YAAC,CAAC,CAAC;YAC5F;YACAlB,MAAM,CAACO,IAAI,GAAGA,IAAI;YAElBb,MAAM,CAAC,WAAW,EAAEa,IAAI,CAAC;YACzBb,MAAM,CAAC,UAAU,EAAEM,MAAM,CAAC;YAC1BN,MAAM,CAAC,UAAU,EAAE;cAAEb,IAAI,EAAEmB,MAAM,CAACnB,IAAI;cAAEL,OAAO,EAAEA,OAAO;YAAG,CAAC,CAAC;YAC7DkB,MAAM,CAAC,YAAY,EAAEM,MAAM,CAAClB,MAAM,CAAC;YACnC;YACAc,OAAO,CAACI,MAAM,CAAC;UACjB,CAAC,MAAM;YACLH,MAAM,CAAC,IAAIsB,KAAK,CAAC,2CAA2C,CAAC,CAAC;UAChE;QACF,CAAC,CAAC,CAACf,KAAK,CAAC,UAAAC,KAAK,EAAI;UAChBR,MAAM,CAACQ,KAAK,CAAC;QACf,CAAC,CAAC;MACJ,CAAC,CAAC;IACJ,CAAC;IAED;IACAe,MAAM,yBAAqB;MAAA,IAAjB1B,MAAM,SAANA,MAAM;QAAEf,KAAK,SAALA,KAAK;MACrB,OAAO,IAAIgB,OAAO,CAAC,UAACC,OAAO,EAAK;QAC9BtB,MAAM,CAACK,KAAK,CAACC,KAAK,CAAC,CAACkB,IAAI,CAAC,YAAM;UAC7BJ,MAAM,CAAC,WAAW,EAAE,EAAE,CAAC;UACvBA,MAAM,CAAC,WAAW,EAAE,EAAE,CAAC;UACvBxB,OAAO,CAACmD,MAAM,CAAC9C,YAAY,CAAC;UAC5BqB,OAAO,EAAE;QACX,CAAC,CAAC,CAACQ,KAAK,CAAC,UAACkB,GAAG,EAAK;UAChBC,OAAO,CAACC,GAAG,CAAC,cAAc,EAAEF,GAAG,CAAC;UAChC;QACF,CAAC,CAAC,CAACG,OAAO,CAAC,YAAM,CACjB,CAAC,CAAC;MACJ,CAAC,CAAC;IACJ;EAEF;AACF,CAAC;AAED,eAAe/C,IAAI"},"metadata":{},"sourceType":"module","externalDependencies":[]}